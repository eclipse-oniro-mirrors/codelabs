"use strict";
/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
 *
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.AssembleHap = void 0;
const hvigor_base_1 = require("@ohos/hvigor-base");
const pre_build_js_1 = require("../pre-build.js");
const collect_har_dependency_js_1 = require("../collect-har-dependency.js");
const merge_profile_js_1 = require("../merge-profile.js");
const process_profile_js_1 = require("../process-profile.js");
const merge_resource_js_1 = require("../merge-resource.js");
const compile_resource_js_1 = require("../compile-resource.js");
const compile_node_js_1 = require("../compile-node.js");
const code_type_enum_js_1 = require("../../enum/code-type-enum.js");
const package_hap_js_1 = require("../package-hap.js");
const sign_hap_js_1 = require("../sign-hap.js");
const legacy_package_hap_js_1 = require("../legacy-tasks/legacy-package-hap.js");
const legacy_merge_profile_js_1 = require("../legacy-tasks/legacy-merge-profile.js");
const legacy_process_profile_js_1 = require("../legacy-tasks/legacy-process-profile.js");
const legacy_compile_resource_js_1 = require("../legacy-tasks/legacy-compile-resource.js");
const legacy_generate_js_manifest_js_1 = require("../legacy-tasks/legacy-generate-js-manifest.js");
const legacy_make_pack_info_js_1 = require("../legacy-tasks/legacy-make-pack-info.js");
const legacy_compile_node_js_1 = require("../legacy-tasks/legacy-compile-node.js");
const compile_native_js_1 = require("../compile-native.js");
const build_native_js_1 = require("../build-native.js");
const process_libs_js_1 = require("../process-libs.js");
const syscap_transform_js_1 = require("../syscap-transform.js");
const generate_loader_json_js_1 = require("../generate-loader-json.js");
/**
 * 组装Hap打包的任务流
 *
 * @since 2022/1/20
 */
class AssembleHap extends hvigor_base_1.Task {
    constructor(taskService, isFaMode) {
        super();
        this.registry = () => {
            const hvigor = new hvigor_base_1.Hvigor();
            if (this._isFaMode) {
                return hvigor.series(new pre_build_js_1.PreBuild(this._taskService).registry(), new collect_har_dependency_js_1.CollectHarDependency(this._taskService).registry(), new legacy_merge_profile_js_1.LegacyMergeProfile(this._taskService).registry(), new legacy_process_profile_js_1.LegacyProcessProfile(this._taskService).registry(), new legacy_compile_resource_js_1.LegacyCompileResource(this._taskService).registry(), new legacy_generate_js_manifest_js_1.LegacyGenerateJsManifest(this._taskService).registry(), new generate_loader_json_js_1.GenerateLoaderJson(this._taskService).registry(), new legacy_compile_node_js_1.LegacyCompileNode(this._taskService, code_type_enum_js_1.CodeType.ETS).registry(), new legacy_compile_node_js_1.LegacyCompileNode(this._taskService, code_type_enum_js_1.CodeType.JS).registry(), new compile_native_js_1.CompileNative(this._taskService).registry(), new build_native_js_1.BuildNative(this._taskService).registry(), new process_libs_js_1.ProcessLibs(this._taskService).registry(), new syscap_transform_js_1.SyscapTransform(this._taskService).registry(), new legacy_make_pack_info_js_1.LegacyMakePackInfo(this._taskService).registry(), new legacy_package_hap_js_1.LegacyPackageHap(this._taskService).registry(), new sign_hap_js_1.SignHap(this._taskService).registry());
            }
            return hvigor.series(new pre_build_js_1.PreBuild(this._taskService).registry(), new collect_har_dependency_js_1.CollectHarDependency(this._taskService).registry(), new merge_profile_js_1.MergeProfile(this._taskService).registry(), new process_profile_js_1.ProcessProfile(this._taskService).registry(), new merge_resource_js_1.MergeResource(this._taskService).registry(), new compile_resource_js_1.CompileResource(this._taskService).registry(), new generate_loader_json_js_1.GenerateLoaderJson(this._taskService).registry(), hvigor.parallel(new compile_node_js_1.CompileNode(this._taskService, code_type_enum_js_1.CodeType.ETS).registry(), new compile_node_js_1.CompileNode(this._taskService, code_type_enum_js_1.CodeType.JS).registry(), new compile_native_js_1.CompileNative(this._taskService).registry()), new build_native_js_1.BuildNative(this._taskService).registry(), new process_libs_js_1.ProcessLibs(this._taskService).registry(), new syscap_transform_js_1.SyscapTransform(this._taskService).registry(), new package_hap_js_1.PackageHap(this._taskService).registry(), new sign_hap_js_1.SignHap(this._taskService).registry());
        };
        this._taskService = taskService;
        this._isFaMode = isFaMode;
    }
}
exports.AssembleHap = AssembleHap;
//# sourceMappingURL=assemble-hap.js.map