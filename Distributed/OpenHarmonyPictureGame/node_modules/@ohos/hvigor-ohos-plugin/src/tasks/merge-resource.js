"use strict";
/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2021-2022. All rights reserved.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MergeResource = void 0;
const fs_1 = __importDefault(require("fs"));
const os_1 = __importDefault(require("os"));
const file_util_js_1 = require("../utils/file-util.js");
const ohos_hap_task_js_1 = require("./task/ohos-hap-task.js");
/**
 * 合并资源到一个index文件中
 *
 * @since 2022/1/10
 */
class MergeResource extends ohos_hap_task_js_1.OhosHapTask {
    constructor(taskService) {
        super(taskService, "MergeResource");
    }
    doTaskAction(targetData, target) {
        const moduleModel = this.service.getModuleModel();
        const moduleType = moduleModel.getModuleType();
        if (!moduleType) {
            return;
        }
        const pathInfo = targetData.getPathInfo();
        const mergeResDir = pathInfo.getIntermediatesMergeRes();
        const mergeFile = pathInfo.getIntermediatesMergeFile();
        file_util_js_1.FileUtil.checkDirWithoutDelete(mergeResDir);
        file_util_js_1.FileUtil.checkFile(mergeFile);
        fs_1.default.writeFileSync(mergeFile, `"${moduleModel.getSourceSetByTargetName(target).getSourceSetRoot()}"${os_1.default.EOL}`);
    }
}
exports.MergeResource = MergeResource;
//# sourceMappingURL=merge-resource.js.map