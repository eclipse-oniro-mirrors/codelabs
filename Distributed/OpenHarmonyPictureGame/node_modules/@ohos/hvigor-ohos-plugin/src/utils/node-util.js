"use strict";
/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
 *
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.findValidNodeExePath = exports.findValidNodeDir = exports.isValidNodePath = void 0;
const path_1 = __importDefault(require("path"));
const fs_extra_1 = __importDefault(require("fs-extra"));
const common_const_js_1 = require("../const/common-const.js");
const system_util_js_1 = require("./system-util.js");
const ohos_logger_js_1 = require("./log/ohos-logger.js");
/**
 * 判断node的路径是否正确有效
 *
 * @param nodePath
 */
function isValidNodePath(nodePath) {
    const _log = ohos_logger_js_1.OhosLogger.getLogger();
    if (!fs_extra_1.default.existsSync(nodePath)) {
        _log.errorMessageExit(`The node path '${nodePath}' configure in local.properties is error,Please confirm!`);
    }
    const nodeExePath = path_1.default.resolve(nodePath, (0, system_util_js_1.isWindows)() ?
        common_const_js_1.CommonNodeConst.NODE_EXE : common_const_js_1.CommonNodeConst.NODE);
    if (!fs_extra_1.default.existsSync(nodeExePath)) {
        _log.errorMessageExit(`Can not find ${nodeExePath}. Please confirm!`);
    }
}
exports.isValidNodePath = isValidNodePath;
/**
 * 从执行项目的环境中找到有效的nodeDir目录
 * local.properties优先级大于env，env中的node环境来源于执行该次构建的Node路径
 *
 * @param nodePath node.exe的父目录
 */
function findValidNodeDir(nodePath) {
    if (nodePath === undefined) {
        return path_1.default.resolve(process.argv0, "..");
    }
    else {
        isValidNodePath(nodePath);
        return nodePath;
    }
}
exports.findValidNodeDir = findValidNodeDir;
/**
 * 从执行项目的环境中找到可执行的node.exe
 * local.properties优先级大于env，env中的node环境来源于执行该次构建的Node路径
 *
 * @param nodePath node.exe的父目录
 */
function findValidNodeExePath(nodePath) {
    return path_1.default.resolve(findValidNodeDir(nodePath), (0, system_util_js_1.isWindows)() ?
        common_const_js_1.CommonNodeConst.NODE_EXE : common_const_js_1.CommonNodeConst.NODE);
}
exports.findValidNodeExePath = findValidNodeExePath;
//# sourceMappingURL=node-util.js.map