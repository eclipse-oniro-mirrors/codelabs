"use strict";
/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
 *
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.AbstractModulePlugin = void 0;
const module_task_service_js_1 = require("../../tasks/service/module-task-service.js");
const legacy_project_model_impl_js_1 = require("../../model/project/legacy-project-model-impl.js");
const legacy_module_model_impl_js_1 = require("../../model/module/legacy-module-model-impl.js");
const module_model_impl_js_1 = require("../../model/module/module-model-impl.js");
const project_model_impl_js_1 = require("../../model/project/project-model-impl.js");
const hap_extra_info_js_1 = require("../../project/data/hap-extra-info.js");
const ohos_logger_js_1 = require("../../utils/log/ohos-logger.js");
/**
 * hap模块的抽象接口
 *
 * @since 2022/1/20
 */
class AbstractModulePlugin {
    constructor(module, isFaMode) {
        this._log = ohos_logger_js_1.OhosLogger.getLogger(AbstractModulePlugin.name);
        this._module = module;
        const project = module.getProject();
        this.isFaMode = isFaMode;
        if (this.isFaMode) {
            this._projectModel = legacy_project_model_impl_js_1.LegacyProjectModelImpl.getInstance(project.getModuleDir(), project.getName());
            this._moduleModel = new legacy_module_model_impl_js_1.LegacyModuleModelImpl(module.getModuleDir(), module.getName(), this._projectModel);
            this.checkModuleStatus(hap_extra_info_js_1.ApiType.FA);
        }
        else {
            this._projectModel = project_model_impl_js_1.ProjectModelImpl.getInstance(project.getModuleDir(), project.getName());
            this._moduleModel = new module_model_impl_js_1.ModuleModelImpl(module.getModuleDir(), module.getName(), this._projectModel);
            this.checkModuleStatus(hap_extra_info_js_1.ApiType.STAGE);
        }
        this._taskService = new module_task_service_js_1.ModuleTaskService(this._projectModel, this._moduleModel);
        this.initTasks();
    }
    checkModuleStatus(apiType) {
        const curApiType = this._moduleModel.getProfileOpt().apiType === undefined ?
            hap_extra_info_js_1.ApiType.STAGE :
            this._moduleModel.getProfileOpt().apiType;
        if (curApiType !== apiType) {
            this._log._buildError("The 'hvigorfile.js' import is not match the apiType!")
                ._solution(`Change the apiType to '${apiType}'.`)
                ._file(this._moduleModel.getProfilePath())
                ._printErrorAndExit(this._moduleModel.getName());
        }
    }
    getTaskService() {
        return this._taskService;
    }
}
exports.AbstractModulePlugin = AbstractModulePlugin;
//# sourceMappingURL=abstract-module-plugin.js.map