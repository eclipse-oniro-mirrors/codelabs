"use strict";
/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2022-2022. All rights reserved.
 *
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.GenerateResourcesShell = void 0;
const ohos_hap_task_js_1 = require("../task/ohos-hap-task.js");
const file_util_js_1 = require("../../utils/file-util.js");
const aapt2_command_builder_js_1 = require("../../builder/aapt2-command-builder.js");
const process_utils_js_1 = require("../../utils/process-utils.js");
const path_1 = __importDefault(require("path"));
const ohos_logger_js_1 = require("../../utils/log/ohos-logger.js");
/**
 * aapt编译资源shell
 *
 * @since 2022/02/19
 */
class GenerateResourcesShell extends ohos_hap_task_js_1.OhosHapTask {
    constructor(taskService) {
        super(taskService, 'GenerateResourceShell');
        this._log = ohos_logger_js_1.OhosLogger.getLogger(GenerateResourcesShell.name);
        const sdkInfo = taskService.getSdkInfo();
        this.aaptTool = sdkInfo.getAapt2Tool();
    }
    doTaskAction(targetData, target) {
        const pathInfo = targetData.getPathInfo();
        const shellResourceDir = pathInfo.getShellResourceDir();
        const shellBuildResourceDir = pathInfo.getShellBuildResourceDir();
        file_util_js_1.FileUtil.checkDirWithoutDelete(shellResourceDir);
        file_util_js_1.FileUtil.checkDirWithoutDelete(shellBuildResourceDir);
        const builder = new aapt2_command_builder_js_1.Aapt2CommandBuilder(this.aaptTool)
            .compile()
            .addDirectory(shellResourceDir)
            .addOutputPath(path_1.default.resolve(shellBuildResourceDir, 'res.zip'));
        const commands = builder.build();
        this._log._printDebugCommand("Aapt", commands);
        new process_utils_js_1.ProcessUtils(this.moduleName, this.taskName).executeSync(commands);
    }
}
exports.GenerateResourcesShell = GenerateResourcesShell;
//# sourceMappingURL=generate-resources-shell.js.map