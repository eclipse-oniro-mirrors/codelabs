"use strict";
/*
 * Copyright (c) Huawei Technologies Co., Ltd. 2021-2022. All rights reserved.
 *
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.PackageSubHaps = void 0;
const ohos_app_task_js_1 = require("./task/ohos-app-task.js");
const process_utils_js_1 = require("../utils/process-utils.js");
const common_const_js_1 = require("../const/common-const.js");
const node_util_js_1 = require("../utils/node-util.js");
const ohos_logger_js_1 = require("../utils/log/ohos-logger.js");
/**
 * 调用打hap包的task
 *
 * @since 2022/1/22
 */
class PackageSubHaps extends ohos_app_task_js_1.OhosAppTask {
    constructor(taskService) {
        super(taskService, "PackageSubHaps");
        this._log = ohos_logger_js_1.OhosLogger.getLogger(PackageSubHaps.name);
    }
    doTaskAction() {
        const targetProductName = this.service.getTargetProduct().name;
        const nodeJsPath = (0, node_util_js_1.findValidNodeExePath)(this.service.getSdkInfo().getNodeJsDir());
        const commands = this.initExecuteCommand(targetProductName, nodeJsPath);
        this._log.debug("PackageSubHap", commands.join(' '));
        new process_utils_js_1.ProcessUtils().executeSync(commands, { stdout: process.stdout, stderr: process.stderr });
        this._log.debug('All hap package finished ======================================================');
    }
    initExecuteCommand(product, nodeJsPath) {
        const command = [nodeJsPath, require.resolve("@ohos/hvigor/bin/hvigor"), "-m", "module", "-p"];
        command.push(`product=${product}`);
        command.push("-p");
        command.push(`${common_const_js_1.CommonConst.DEBUGGABLE}=false`);
        command.push("assembleHap");
        command.push(this._log._getCliLevel());
        return command;
    }
}
exports.PackageSubHaps = PackageSubHaps;
//# sourceMappingURL=package-sub-hap.js.map